<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Amqphp persistent connection testbed.</title>
    <style type="text/css">
      .layout-table {
        border: 1px solid black;
        width: 100%;
      }
      .layout-table td {
        vertical-align: top;
        padding: 0.25em;
      }
      .bigger {
        font-size: 1.5em;
      }
      label {
        display: block;
        clear: both;
      }
      .sent .send .received .receive {
        vertical-align: top;
      }
      ul.conn-props {
        list-style: none;
      }
    </style>
  </head>
  <body>
    <h1>Experiment with Amqphp persistent connections!</h1>

    <?php if ($this->messages) { ?><!-- Begin messages -->
    <div id="messages">
      <ul>
        <?php foreach ($this->messages as $i => $m) { ?>
          <li><?php echo $m ?></li>
        <?php } ?>
      </ul>
    </div>
    <?php } ?><!-- End messages -->



    <h2>Connection Data</h2>
    <div id="conn-data">
      <span class="point">PHP process ID: <strong><?php echo getmypid(); ?></strong></span>


      <?php foreach ($this->demo->getConnections() as $conn) { ?>
      <div class="conn-info">
        <h3>Connection <?php echo $conn->getSocketCK() ?></h3>
        <ul class="conn-props">
          <li>Amqp VHost: <strong><?php echo $conn->getVHost() ?></strong></li>
          <li>Connection presistence status: <strong><?php
switch ($_tmp = $conn->getPersistenceStatus()) {
case \amqphp\PConnection::SOCK_NEW:
  echo "New Connection";
break;
case \amqphp\PConnection::SOCK_REUSED:
  echo "Connection re-used";
break;
default:
  echo "Unknown ($_tmp)";
}
              ?></strong></li>
          <li>Channels: <?php echo count($conn->getChannels()) ?></li>
          <li>Capabilities:<ul class="conn-caps"><?php
foreach ($conn->capabilities as $k => $cb) {?>
              <li><?php echo $k ?> = <?php echo $cb; ?></li>
<?php } ?></ul></li>
        </ul>
      </div>
      <?php } ?>
    </div>



    <table id="read-layout" class="layout-table">
      <tbody>
        <tr>
          <td>
            <div id="received">
              <h3>Received</h3>

              <?php if (isset($this->received) && count($this->received) > 0) { ?>
              <table class="listing">
                <thead>
                  <tr>
                    <th>Message</th>
                  </tr>
                </thead>
                <tbody>
                  <?php foreach ($this->received as $r) { ?>
                  <tr>
                    <td><?php echo $r ?></td>
                  </tr>
                  <?php } ?>
                </tbody>
              </table>
              <?php } else { ?>
                <strong>No messages were received</strong>
              <?php } ?>

            </div>
          </td>
          <td>
            <div id="sent">
              <h3>Sent</h3>

              <?php if (isset($this->sent) && count($this->sent) > 0) { ?>
              <table class="listing">
                <thead>
                  <tr>
                    <th>Message</th>
                  </tr>
                </thead>
                <tbody>
                  <?php foreach ($this->sent as $m) { ?>
                  <tr>
                    <td><?php echo $m ?></td>
                  </tr>
                  <?php } ?>

                </tbody>
              </table>
              <?php } else { ?>
                <strong>No messages were sent</strong>
              <?php } ?>

            </div>
          </td>
        </tr>
      </tbody>
    </table>


    <form method="GET" id="controls" class="layout-table">
      <span class="left">
        <label for="action-send">Send Messages <input type="checkbox" name="action[tasks][]" value="send" id="action-send"/></label>
        <label for="action-receive">Receive Messages <input type="checkbox" name="action[tasks][]" value="receive" id="action-receive"/></label>
      </span>

      <span class="right">
        <label for="action-sendfirst">Process sends first <input id="action-sendfirst" type="radio" name="action[web-req-seq]" value="send_first" checked="checked"/></label>
        <label for="action-receivefirst">Process receives first <input id="action-receivefirst" type="radio" name="action[web-req-seq]" value="receive_first" checked="checked"/></label>
      </span>
      <input type="submit" value="Go.."/>

      <hr/>
      <table id="write-layout">
        <tbody>
          <tr>
            <td>
              <div id="send">
                <h3>Send Messages</h3>
                <span class="bigger">Repeat this sequence of messages <input type="send[ntimes]" value="1"/> time(s)
                  <label for="send-chans-cycle">Cycle channels<input id="send-chans-cycle" type="radio" name="send[chans]" value="cycle" selected="selected"/></label>
                  <label for="send-chans-each">Per channel<input id="send-chans-each" type="radio" name="send[chans]" value="each" selected="selected"/></label></span>
                <hr/>
                <textarea id="new-msg-1" name="send[messages][]"></textarea>
                <button id="new-msg-btn">Another</button>
              </div>
            </td>
            <td>
              <div id="receive">
                <h3>Receive messages</h3>
                <label for="select-relative">
                  SELECT_TIMEOUT_REL <input id="select-relative" type="radio" name="read[select-mode]" value="relative" checked="checked"/>
                </label>
                <label for="read-select-rel-secs">Secs<input type="text" name="read[select-rel-secs]" value="1"/></label>
                <label for="read-select-rel-usecs">Usecs<input type="text" name="read[select-rel-usecs]" value="5000"/></label>

                <label for="select-maxloops">
                  SELECT_MAXLOOPS <input id="select-maxloops" type="radio" name="read[select-mode]" value="maxloops"/>
                </label>
                <label for="read-select-maxloops-num"><input type="text" name="read[select-maxloops-num]"/></label>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </form>
    
  </body>
</html>
