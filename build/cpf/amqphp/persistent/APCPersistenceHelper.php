<?php
 namespace amqphp\persistent; class APCPersistenceHelper implements PersistenceHelper { private $data; private $uk; function setUrlKey ($k) { if (is_null($k)) { throw new \Exception("Url key cannot be null", 8260); } $this->uk = $k; } function getData () { return $this->data; } function setData ($data) { $this->data = $data; } private function getKey () { if (is_null($this->uk)) { throw new \Exception("Url key cannot be null", 8261); } return sprintf('apc.amqphp.%s.%s', getmypid(), $this->uk); } function save () { $k = $this->getKey(); return apc_store($k, $this->data); } function load () { $success = false; $this->data = apc_fetch($this->getKey(), $success); return $success; } function destroy () { return apc_delete($this->getKey()); } }