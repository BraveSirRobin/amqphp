<?php
 namespace amqphp; use amqphp\protocol; use amqphp\wire; class MaxloopExitStrategy implements ExitStrategy { private $maxLoops; private $nLoops; function configure ($sMode, $ml=null) { if (! (is_int($ml) || is_numeric($ml)) || $ml == 0) { trigger_error("Select mode - invalid maxloops params : '$ml'", E_USER_WARNING); return false; } else { $this->maxLoops = (int) $ml; return true; } } function init (Connection $conn) { $this->nLoops = 0; } function preSelect ($prev=null) { if ($prev === false) { return false; } if (++$this->nLoops > $this->maxLoops) { return false; } else { return $prev; } } function complete () {} } 